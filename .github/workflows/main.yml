name: Java CI/CD (Optimized)

# Kích hoạt khi có push hoặc pull request lên nhánh master
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build_and_test: # Đổi tên job thành tên mô tả hơn

    runs-on: ubuntu-latest

    steps:
      # Bước 1: Checkout code từ repository
      - uses: actions/checkout@v4

      # Bước 2: Thiết lập môi trường Java
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      # Bước 3: Build, Compile, và Chạy Unit Test (Đã tích hợp)
      # Lệnh 'mvn clean verify' thực hiện: clean, compile, test (chạy tất cả Unit Test), package, và verify.
      # Nếu bước 'test' thất bại, toàn bộ workflow sẽ thất bại (FAILURE).
      - name: Build and Run All Unit Tests
        run: mvn clean verify